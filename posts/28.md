---
title: 'PR ìƒì„±ì‹œ í…”ë ˆê·¸ë¨ ì•Œë¦¼ ë³´ë‚´ê¸°'
date: '2022-07-01'
tag: 'github'
---

# PR action

## [PR template ë§Œë“¤ê¸°]

### .github/pull_request_template.md ì‘ì„±

![24-1](https://user-images.githubusercontent.com/60374596/185749806-fad07ef1-13df-4a0e-a89a-3b1edf404395.png)

## [Reviewer ìë™ ì§€ì •]

### 1. Organizationì— Team ìƒì„± ë° ë©¤ë²„ ì´ˆëŒ€

### 2. .github/CODEOWNERS ì— íŒ€ì„ ë¦¬ë·°ì–´ë¡œ ë“±ë¡

![24-2](https://user-images.githubusercontent.com/60374596/185749805-bcedbebb-f78b-46c3-abab-9a9c51371449.png)

> ë§Œì•½Â Private Repositoryë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê³„ì •ì„ ì‚¬ìš©í•´ì•¼ì§€ë§Œ CODEOWNERSê°€ ë™ì‘í•œë‹¤. ex) GitHub Pro / GitHub Team / GitHub Enterprise Cloud / GitHub Enterprise Server

## [PR ìƒì„±ì‹œ telegramìœ¼ë¡œ ë©”ì„¸ì§€ ë³´ë‚´ê¸°]

### 1. BotFatherë¡œ telegram bot ìƒì„±

![bot](https://user-images.githubusercontent.com/60374596/186362339-94148a89-5acc-4bfc-9acd-9ca906876cab.png)

### 2. ê·¸ë£¹ì— botì´ˆëŒ€ í›„ ì±„ë„ IDí™•ì¸

[https://api.telegram.org/bot<ë´‡ID>/getUpdates](https://api.telegram.org/bot5448790919:AAHX_LD5qnoNSRoqs00YE5jvsvyNRC-2YCA/getUpdates)

### 3. Github repository > Settings > Secrets > Actions > New repository screts

- TELEGRAM_TOKEN : bot token ì €ì¥
- TELEGRAM_TO: ì±„ë„ id ì €ì¥

### 4. Github repository > Actions > set up a workflow yourself

```js
// tg-notify.yml
name: tg-notify
on: [pull_request]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Update status
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_TO }}
        token: ${{ secrets.TELEGRAM_TOKEN }}
        message: |  #https://help.github.com/en/actions/reference/contexts-and-expression-syntax-for-github-actions#github-context
          ${{ github.event_name }} commit in ${{ github.repository }} by "${{ github.actor }}". [${{github.sha}}@${{ github.ref }}]
```

pull_request ì‹œ ì‹¤í–‰í•  action(telegram-action) ìƒì„±

### 5. pr ìƒì„± í›„ í™•ì¸

actionì´ ì¼ì–´ë‚˜ë©´ ë©”ì„¸ì§€ê°€ ì˜¨ë‹¤.

![test](https://user-images.githubusercontent.com/60374596/186367065-965c7c48-649d-4de4-a729-3e009b33057d.png)

## (ì¶”ê°€) Webhook ì´ìš©í•˜ê¸°

Github Actionì„ ì´ìš©í•  ë•Œ ë°›ì„ ìˆ˜ ìˆëŠ” action ì˜ payloadê°€ í•œì •ì ì´ë‹¤.

webhookì„ ì´ìš©í•˜ë©´ payloadì— ë‹´ê²¨ì˜¤ëŠ” ë°ì´í„°ê°€ ë§ì•„ ë‚´ê°€ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
Actionì„ ì´ìš©í–ˆì„ ë•ŒëŠ” pr urlì„ ë°›ì•„ ì˜¬ ìˆ˜ ì—†ì–´ ë©”ì„¸ì§€ì—ì„œ ë°”ë¡œ í•´ë‹¹ prë¡œ ì´ë™í•˜ê¸° ë¶ˆí¸í•˜ì—¬ actionì„ ì œê±°í•˜ê³  webhookìœ¼ë¡œ ì—°ê²°ì„ ë°”ê¿¨ë‹¤.

### 1. webhookì„ ë°›ì•„ í…”ë ˆê·¸ë¨ ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ëŠ” APIë¥¼ ë§Œë“ ë‹¤.

```js
// app.js
const express = require('express');
const bodyParser = require('body-parser');
const TelegramBot = require('node-telegram-bot-api');

require('dotenv').config();

// Initialize express and define a port
const app = express();
const PORT = 8080;

const token = process.env.TELEGRAM_TOKEN;
const chatId = process.env.CHAT_ID;
const bot = new TelegramBot(token, { polling: true });

app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());

app.post('/message', (req, res) => {
  if (req.body.action === 'opened')
    bot.sendMessage(
      chatId,
      `[Pull Requests Opened]\n${req.body.pull_request.html_url}\n# ${req.body.pull_request.title}\n\n${req.body.pull_request.body}`
    );
  res.status(200).end();
});

app.listen(PORT, () => console.log(`ğŸš€ Server running on port ${PORT}`));
```

í…”ë ˆê·¸ë¨ ë´‡ api ëª¨ë“ˆì„ ì„¤ì¹˜í•˜ê³  .envì— ìˆëŠ” í…”ë ˆê·¸ë¨ í† í°ê³¼ ì±„ë„ IDë¥¼ ì €ì¥í•œë‹¤.

`/message`ë¡œ ë“¤ì–´ì˜¨ requestê°€ `opened`(pr ìƒì„±ë¨)ì´ë©´ ë´‡ìœ¼ë¡œ ë©”ì„¸ì§€ë¥¼ ì „ì†¡í•œë‹¤.

í•´ë‹¹ APIë¥¼ ì„œë²„ì— Docker containerë¡œ ë„ì›Œë’€ë‹¤.

### 2. Webhook ì—°ê²°

Github repository > Settings > Webhooks > Add webhook

![add](https://user-images.githubusercontent.com/60374596/186365370-76432429-8349-4699-b5f1-1b85ac165d33.png)

Payload URLì— API ì£¼ì†Œë¥¼ ì ê³  ë°›ì„ ë°ì´í„° íƒ€ì…ì„ application/jsonìœ¼ë¡œ ì„ íƒí•œë‹¤.

ë‚˜ëŠ” pr ìƒì„±ì‹œì—ë§Œ webhookì„ í˜¸ì¶œí•˜ê³  ì‹¶ì–´ì„œ eventëŠ” **Let me select indinidual events**ë¥¼ ì„ íƒí–ˆë‹¤.

![pr](https://user-images.githubusercontent.com/60374596/186365383-9ac035f8-5aa0-4142-8596-f5e7f6e1ed08.png)

Pull requests ì„ íƒ í›„ Add webhookì„ í´ë¦­í•˜ë©´ webhookì´ ë“±ë¡ëœë‹¤.

### 3. í™•ì¸

prì„ ìƒì„±í•˜ê³  ë©”ì„¸ì§€ê°€ ì˜¤ëŠ”ì§€ í™•ì¸

![msg](https://user-images.githubusercontent.com/60374596/186366463-f898cd91-10d2-4bda-9df2-375abea93279.png)

ì°¸ê³ 

[https://goodgid.github.io/Github-CODEOWNERS/](https://goodgid.github.io/Github-CODEOWNERS/)

[https://github.com/appleboy/telegram-action](https://github.com/appleboy/telegram-action)

[https://cyaninfinite.com/getting-updates-from-github-via-telegram-bot/](https://cyaninfinite.com/getting-updates-from-github-via-telegram-bot/)

[Github Docs-Webhook events and payloads](https://docs.github.com/en/developers/webhooks-and-events/webhooks/webhook-events-and-payloads)
